# Kode斜杠命令分析

本文档详细分析了Kode项目中所有可用的斜杠命令（slash commands）。

## 概述

Kode使用斜杠前缀（`/`）来识别和处理特殊命令，这些命令提供了项目管理的核心功能。命令系统支持：

- **内置命令**: 核心功能命令
- **MCP命令**: 从MCP服务器动态加载
- **自定义命令**: 用户定义的命令

## 命令系统架构

### 命令检测
斜杠命令的检测逻辑位于 [`src/utils/messages.tsx:260`](../src/utils/messages.tsx#L260)：

```typescript
// Slash commands
if (input.startsWith('/')) {
  const words = input.slice(1).split(' ')
  let commandName = words[0]
  // ... 命令处理逻辑
}
```

### 命令类型
命令支持三种类型（[`src/commands.ts:33-77`](../src/commands.ts#L33-L77)）：

1. **Prompt命令** (`type: 'prompt'`) - 生成AI提示
2. **本地命令** (`type: 'local'`) - 本地执行
3. **本地JSX命令** (`type: 'local-jsx'`) - 带UI组件的本地执行

## 内置斜杠命令 (23个)

从 [`src/commands.ts`](../src/commands.ts#L83-L104) 中分析，Kode包含以下内置命令：

### 核心功能命令 (19个)

| 命令 | 功能描述 | 文件位置 |
|------|----------|----------|
| `/agents` | 代理管理和管理界面 | [`src/commands/agents.tsx`](../src/commands/agents.tsx) |
| `/clear` | 清除终端和对话历史 | [`src/commands/clear.ts`](../src/commands/clear.ts) |
| `/compact` | 压缩对话上下文 | [`src/commands/compact.ts`](../src/commands/compact.ts) |
| `/config` | 配置管理 | [`src/commands/config.tsx`](../src/commands/config.tsx) |
| `/cost` | 显示使用成本 | [`src/commands/cost.ts`](../src/commands/cost.ts) |
| `/doctor` | 诊断工具 | [`src/commands/doctor.ts`](../src/commands/doctor.ts) |
| `/help` | 帮助系统 | [`src/commands/help.tsx`](../src/commands/help.tsx) |
| `/init` | 项目初始化 | [`src/commands/init.ts`](../src/commands/init.ts) |
| `/mcp` | MCP (Model Context Protocol) 管理 | [`src/commands/mcp.ts`](../src/commands/mcp.ts) |
| `/model` | 模型管理 | [`src/commands/model.tsx`](../src/commands/model.tsx) |
| `/modelstatus` | 模型状态显示 | [`src/commands/modelstatus.tsx`](../src/commands/modelstatus.tsx) |
| `/onboarding` | 新用户引导 | [`src/commands/onboarding.tsx`](../src/commands/onboarding.tsx) |
| `/pr_comments` | PR评论相关 | [`src/commands/pr_comments.ts`](../src/commands/pr_comments.ts) |
| `/refreshCommands` | 刷新命令列表 | [`src/commands/refreshCommands.ts`](../src/commands/refreshCommands.ts) |
| `/release-notes` | 发布说明 | [`src/commands/release-notes.ts`](../src/commands/release-notes.ts) |
| `/bug` | 错误报告 | [`src/commands/bug.tsx`](../src/commands/bug.tsx) |
| `/review` | 代码审查 | [`src/commands/review.ts`](../src/commands/review.ts) |
| `/terminalSetup` | 终端设置 | [`src/commands/terminalSetup.ts`](../src/commands/terminalSetup.ts) |

### 认证相关命令 (2个，条件启用)

| 命令 | 功能描述 | 启用条件 | 文件位置 |
|------|----------|----------|----------|
| `/login` | 登录Anthropic账户 | `isAnthropicAuthEnabled()` 为true | [`src/commands/login.tsx`](../src/commands/login.tsx) |
| `/logout` | 登出Anthropic账户 | `isAnthropicAuthEnabled()` 为true | [`src/commands/logout.tsx`](../src/commands/logout.tsx) |

> **注意**: 当前版本中 `isAnthropicAuthEnabled()` 硬编码返回 `false`，所以这两个命令被禁用。

### 内部命令 (3个，通常隐藏)

| 命令 | 功能描述 | 隐藏状态 | 文件位置 |
|------|----------|----------|----------|
| `/ctx_viz` | 上下文可视化 | 内部使用 | [`src/commands/ctx_viz.ts`](../src/commands/ctx_viz.ts) |
| `/resume` | 恢复对话 | 内部使用 | [`src/commands/resume.tsx`](../src/commands/resume.tsx) |
| `/listen` | 监听模式 | 内部使用 | [`src/commands/listen.ts`](../src/commands/listen.ts) |

## 动态命令系统

### MCP命令
- **加载机制**: 通过 `getMCPCommands()` 函数从MCP服务器动态加载
- **数量**: 不定，取决于已安装的MCP服务器
- **标识**: 通常带有 `(MCP)` 后缀

### 自定义命令
- **加载机制**: 通过 `loadCustomCommands()` 函数从指定目录加载
- **存储位置**:
  - `~/.claude/agents/` (Claude Code用户目录兼容)
  - `~/.kode/agents/` (Kode用户目录)
  - `./.claude/agents/` (Claude Code项目目录兼容)
  - `./.kode/agents/` (Kode项目目录)
- **格式**: Markdown文件，包含YAML前置元数据
- **前缀**: 支持 `project:` 和 `user:` 前缀
- **刷新**: 使用 `/refresh-commands` 重新加载

## 命令使用方式

### 基本语法
```bash
/command [arguments]
```

### MCP命令语法
```bash
/command_name (MCP) [arguments]
```

### 自定义命令语法
```bash
/project:command_name [arguments]
/user:command_name [arguments]
```

## 帮助系统

使用 `/help` 命令可以查看：
- 内置命令列表
- 自定义命令列表
- 命令描述和别名
- 使用示例

帮助界面采用渐进式显示模式，避免信息过载。

## 命令状态管理

### 启用/禁用
- 每个命令都有 `isEnabled` 属性
- 可以基于配置或条件动态启用/禁用
- 认证相关命令示例：
  ```typescript
  ...(isAnthropicAuthEnabled() ? [logout, login()] : [])
  ```

### 隐藏命令
- 每个命令都有 `isHidden` 属性
- 隐藏命令不会在 `/help` 中显示
- 主要用于内部调试或特殊功能

## 文件结构

```
src/commands/
├── agents.tsx           # 代理管理
├── bug.tsx             # 错误报告
├── clear.ts            # 清除功能
├── compact.ts          # 压缩上下文
├── config.tsx          # 配置管理
├── cost.ts             # 成本显示
├── ctx_viz.ts          # 上下文可视化 (内部)
├── doctor.ts           # 诊断工具
├── help.tsx            # 帮助系统
├── init.ts             # 项目初始化
├── listen.ts           # 监听模式 (内部)
├── login.tsx           # 登录
├── logout.tsx          # 登出
├── mcp.ts              # MCP管理
├── model.tsx           # 模型管理
├── modelstatus.tsx     # 模型状态
├── onboarding.tsx      # 新用户引导
├── pr_comments.ts      # PR评论
├── refreshCommands.ts  # 刷新命令
├── release-notes.ts    # 发布说明
├── resume.tsx          # 恢复对话 (内部)
├── review.ts           # 代码审查
└── terminalSetup.ts    # 终端设置
```

## 总结

**Kode斜杠命令总数**:
- **内置命令**: 23个 (包括3个内部隐藏命令)
- **MCP命令**: 动态数量 (取决于MCP服务器配置)
- **自定义命令**: 动态数量 (取决于用户创建)

**总计**: 至少20个用户可见的内置命令，外加动态加载的MCP和自定义命令。

这种模块化的命令系统设计使Kode既保持了核心功能的稳定性，又提供了良好的扩展性，用户可以根据需要添加自定义命令和MCP集成。

---

*创建时间: 2025-11-28*
*分析对象: Kode项目斜杠命令系统*
*命令总数: 23个内置命令 (20个用户可见)*